<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Send Push Notification</title>
</head>
<body>

<form id="notificationForm">
  <label for="title">Title</label>
  <input type="text" id="title" name="title" value="Notification Title" required>

  <label for="body">Body</label>
  <textarea id="body" name="body" required>Notification Text</textarea>

  <label for="icon">Icon URL</label>
  <input type="url" id="icon" name="icon" value="https://your-domain.com/icon.png" required>

  <label for="image">Image URL</label>
  <input type="url" id="image" name="image" value="https://your-domain.com/image.jpg">

  <label for="click_action">Click Action URL</label>
  <input type="url" id="click_action" name="click_action" value="https://destination-url.com" required>

  <button type="submit">Send</button>
</form>

<!-- Firebase setup -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCLmu0AVrrz88EUdi8HDtRapUHYbVZ-yHQ",
    authDomain: "snapit-now.firebaseapp.com",
    projectId: "snapit-now",
    storageBucket: "snapit-now.firebasestorage.app",
    messagingSenderId: "672066953267",
    appId: "1:672066953267:web:f972305cd9f4261fa54346",
    measurementId: "G-KPV95KE9X5"
  };

  const app = initializeApp(firebaseConfig);
  const messaging = getMessaging(app);

  // Request permission and get token
  async function requestPermissionAndGetToken() {
    try {
      const permission = await Notification.requestPermission();
      if (permission === 'granted') {
        const currentToken = await getToken(messaging, { vapidKey: 'BCOQGJQipo-tL_GnzHrGKqSG1ILb7dI2Gcu7BxNQJm57Uq08P9jRLJNvIPOENAdmCPem3kUlpmoSOGiLitjAHWw' });
        if (currentToken) {
          console.log('FCM Token:', currentToken);
          return currentToken;
        } else {
          console.log('No registration token available. Request permission to generate one.');
        }
      } else {
        console.log('Notification permission denied');
      }
    } catch (err) {
      console.error('An error occurred while retrieving token. ', err);
    }
    return null;
  }

  // Handle foreground messages
  onMessage(messaging, (payload) => {
    console.log('Message received. ', payload);
    const { title, body, icon, image, click_action } = payload.notification;
    new Notification(title, { body, icon, image }).onclick = () => {
      window.open(click_action, '_blank');
    };
  });

  // On form submit - send the notification (for demo purpose only sending notification on the client)
  document.getElementById('notificationForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const token = await requestPermissionAndGetToken();
    if (!token) {
      alert('Unable to get permission for notifications');
      return;
    }

    const title = event.target.title.value;
    const body = event.target.body.value;
    const icon = event.target.icon.value;
    const image = event.target.image.value;
    const click_action = event.target.click_action.value;

    // This example triggers a local notification immediately (client side only)
    new Notification(title, { body, icon, image }).onclick = () => {
      window.open(click_action, '_blank');
    };

    // To send push notifications via Firebase servers, you need your backend server to send the notification using the token
    // You can send the token and notification data to your backend here for server side push triggering

    alert('Notification sent locally. For real push notifications, send this data to your backend.');
  });
</script>

</body>
</html>
